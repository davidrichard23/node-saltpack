image: node:12

cache:
    paths:
        - node_modules/

before_script:
    - npm --color="always" install

build:
    stage: build
    script:
        - npx tsc
        - PACKAGE=`npm --color="always" pack`
        - mv "$PACKAGE" saltpack.tgz
    artifacts:
        paths:
            - dist
            - saltpack.tgz

test-10:
    image: node:10
    script:
        - npm run test
    dependencies:
        - build

test-12:
    image: node:12
    script:
        - npm run test
    dependencies:
        - build

test-14:
    image: node:14
    script:
        - npm run test
    dependencies:
        - build
